jQuery(document).ready(function(t){function e(){var e=t("#enable-schedule").is(":checked");e?t("#wp-optimize-auto-options").css("opacity","1"):t("#wp-optimize-auto-options").css("opacity","0.5")}function i(t,e,i,o){o="undefined"==typeof o||o;var n={action:"wp_optimize_ajax",subaction:t,nonce:wp_optimize_ajax_nonce,data:e};jQuery.post(ajaxurl,n,function(t){if(o){try{var e=JSON.parse(t)}catch(n){return console.log(n),void console.log(t)}"undefined"!=typeof i&&i(e)}else"undefined"!=typeof i&&i(t)})}function o(e,i,o){i="undefined"==typeof i?"#wp-optimize-wrap":i,o="undefined"==typeof o?15:o,t(e).hide().prependTo(i).slideDown("slow").delay(1e3*o).slideUp("slow",function(){t(this).remove()})}function n(e,n){var s={type:e,enable:n?1:0};t("#"+e+"_spinner").show(),i("enable_or_disable_feature",s,function(i){if(t("#"+e+"_spinner").hide(),i&&i.hasOwnProperty("output"))for(var n=0,s=i.output.length;n<s;n++){var a='<div class="updated">'+i.output[n]+"</div>";o(a,"#actions-results-area")}})}function s(){var e=t("#wp-optimize-nav-tab-contents-settings form input[name!='action'], #wp-optimize-nav-tab-contents-settings form textarea, #wp-optimize-nav-tab-contents-settings form select").serialize();return t.each(t("#wp-optimize-nav-tab-contents-settings form input[type=checkbox]").filter(function(e){return 0==t(this).prop("checked")}),function(i,o){var n="0";e+="&"+t(o).attr("name")+"="+n}),e}function a(){if(!c.get_lock())return void(r>0&&console.log("WP-Optimize: process_queue(): queue is currently locked - exiting"));r>0&&console.log("WP-Optimize: process_queue(): got queue lock");var e=c.peek();return"undefined"==typeof e?(r>0&&console.log("WP-Optimize: process_queue(): queue is apparently empty - exiting"),void c.unlock()):(r>0&&console.log("WP-Optimize: process_queue(): processing item: "+e),c.dequeue(),void i("do_optimization",{optimization_id:e},function(i){if(console.log(i),t("#optimization_spinner_"+e).hide(),t("#optimization_checkbox_"+e).show(),t(".optimization_button_"+e).prop("disabled",!1),i){for(var o="",n=0,s=i.errors.length;n<s;n++)o+='<span class="error">'+i.errors[n]+"</span><br>";for(var n=0,s=i.messages.length;n<s;n++)o+=i.errors[n]+"<br>";for(var n=0,s=i.result.output.length;n<s;n++)o+=i.result.output[n]+"<br>";t("#optimization_info_"+e).html(o),i.hasOwnProperty("status_box_contents")&&t("#wp_optimize_status_box").css("opacity","1").find(".inside").html(i.status_box_contents),i.hasOwnProperty("table_list")&&t("#wpoptimize_table_list tbody").replaceWith(i.table_list),i.hasOwnProperty("total_size")&&t("#optimize_current_db_size").html(i.total_size)}setTimeout(function(){c.unlock(),a()},10)}))}function p(e){var i=t("#wp-optimize-nav-tab-contents-optimize .wp-optimize-settings-"+e);i||console.log("do_optimization: row corresponding to this optimization ("+e+") not found"),t("#optimization_checkbox_"+e).hide(),t("#optimization_spinner_"+e).show(),t(".optimization_button_"+e).prop("disabled",!0),t("#optimization_info_"+e).html("..."),c.enqueue(e),a()}var r=0,c=new Updraft_Queue;e(),t("#enable-schedule").change(function(){e()}),t("#wp-optimize-disable-enable-trackbacks-enable").click(function(){n("trackbacks",!0)}),t("#wp-optimize-disable-enable-trackbacks-disable").click(function(){n("trackbacks",!1)}),t("#wp-optimize-disable-enable-comments-enable").click(function(){n("comments",!0)}),t("#wp-optimize-disable-enable-comments-disable").click(function(){n("comments",!1)}),t("#wp-optimize-nav-tab-wrapper .nav-tab").click(function(e){var i=t(this).attr("id");if(i&&"wp-optimize-nav-tab-"==i.substring(0,20)){var i=i.substring(20);e.preventDefault(),t("#wp-optimize-nav-tab-wrapper .nav-tab:not(#wp-optimize-nav-tab-"+i+")").removeClass("nav-tab-active"),t(this).addClass("nav-tab-active"),t("#wp-optimize-wrap .wp-optimize-nav-tab-contents:not(#wp-optimize-nav-tab-contents-"+i+")").hide(),t("#wp-optimize-nav-tab-contents-"+i).show()}}),t("#wp-optimize-nav-tab-contents-optimize").on("click","button.wp-optimize-settings-optimization-run-button",function(){var e=t(this).closest(".wp-optimize-settings").data("optimization_id");return e?void p(e):void console.log("Optimization ID corresponding to pressed button not found")}),t("#wp-optimize-nav-tab-contents-optimize").on("click","#wp-optimize",function(e){e.preventDefault(),$optimizations=t("#optimizations_list .optimization_checkbox:checked"),$optimizations.sort(function(e,i){return e=t(e).closest(".wp-optimize-settings").data("optimization_run_sort_order"),i=t(i).closest(".wp-optimize-settings").data("optimization_run_sort_order"),e>i?1:e<i?-1:0});var o={};$optimizations.each(function(e){var i=t(this).closest(".wp-optimize-settings").data("optimization_id");return i?(o[i]={active:1},void p(i)):void console.log("Optimization ID corresponding to pressed button not found")}),i("save_manual_run_optimization_options",o)}),t("#wp_optimize_table_list_refresh").click(function(){t("#wpoptimize_table_list tbody").css("opacity","0.5"),i("get_table_list",!1,function(e){t("#wpoptimize_table_list tbody").css("opacity","1"),e.hasOwnProperty("table_list")&&t("#wpoptimize_table_list tbody").replaceWith(e.table_list),e.hasOwnProperty("total_size")&&t("#optimize_current_db_size").html(e.total_size)})}),t("#wp-optimize-settings-save").click(function(e){e.preventDefault(),t("#save_spinner").show();var n=s();i("save_settings",n,function(e){if(t("#save_spinner").hide(),t("#save_done").show().delay(5e3).fadeOut(),e&&e.hasOwnProperty("save_results")&&e.save_results&&e.save_results.hasOwnProperty("errors")){for(var i=0,n=e.save_results.errors.length;i<n;i++){var s='<div class="error">'+e.errors[i]+"</div>";o(s,"#wp-optimize-settings-save-results")}console.log(e.save_results.messages)}e&&e.hasOwnProperty("status_box_contents")&&t("#wp_optimize_status_box .inside").html(e.status_box_contents),e&&e.hasOwnProperty("optimizations_table")&&t("#optimizations_list").replaceWith(e.optimizations_table)})}),t("#wp_optimize_status_box").on("click","#wp_optimize_status_box_refresh",function(e){e.preventDefault(),t("#wp_optimize_status_box").css("opacity","0.5"),i("get_status_box_contents",null,function(e){t("#wp_optimize_status_box").css("opacity","1").find(".inside").html(e)})})});